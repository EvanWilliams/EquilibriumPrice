<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  	<meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Equilibrium Price</title>

    <style>
		.chartWrapper{width:800px;height:400px;}
    	.container {margin:20px;padding:20px;background-color:#76D6FF;}
    	#result {color:#7A81FF;}

    	@media screen and (max-width: 700px) {
		  input {
		    display:block;
		  }
		}
		@media screen and (max-width: 800px) {
		.chartWrapper {
		    width:600px;height:300px;
		  }
		}
		@media screen and (max-width: 600px) {
		.chartWrapper {
		    width:400px;height:200px;
		  }
		}
    </style>

  </head>
  <body>
  	<div id="intro" class="container">
  	ABC Company Inc. has just invented the XYZ Widget. A revolutionary product that will change the lives of everyone that buys it. In this exercise, you will help ABC Company Inc choose the correct equillibrium price for the new product.
  	</div>
  	<div id="input" class="container">
	  	<form>
	  		<div class="section">
		        Price for XYZ Widget:
		        <input type="radio" name="price" value=1> $1
		        <input type="radio" name="price" value=2> $2
		        <input type="radio" name="price" value=3> $3
		        <input type="radio" name="price" value=4> $4
		        <input type="radio" name="price" value=5> $5
		        <input type="radio" name="price" value=6> $6
		        <input type="radio" name="price" value=7> $7
		        <input type="radio" name="price" value=8> $8
		        <input type="radio" name="price" value=9> $9
		        <input type="radio" name="price" value=10> $10
	        </div>

	        <input id="calculate" type="button" value="Calculate">



	        </div>
	    </form>
    </div>
	<div class="chartWrapper">
		<canvas id="myChart"></canvas>
	</div>
	
    <div id="result" class="container">

   	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   	<script language="javascript">

    	// Equilibrium Price Equations:
    	//   Qsupply = Msupply * price + Bsupply
		//   Qdemand = Mdemand * price + Bdemand

    	let Mdemand = -1000;
    	let Bdemand = 10000;
    	let Msupply = 0; // what if ABC can hire more people when price goes up? 
    	let Bsupply = 8000;
    	let consumption;
    	let supply;
		let revenue;
    	let message;

    	document.getElementById("calculate").addEventListener("click", calculateOutput);

		function calculateOutput() {
			let price;
			let priceOptions = document.getElementsByName("price");
			let maxRevenue = 0;
			let revenueObject = {};
			let chartData = {
				"labels":[],
				"revenue":[],
				"supply":[],
				"demand":[]
			}
			message = "";

			const calculateMaxRevenue = (maxRevenue,priceOption) => {
				//Inner function that calculates the maxRevenue and saves all the other variables so there is no need to recalculate later.

				priceOptions.forEach( (priceOption) => {
					let consumption = priceOption.value * Mdemand + Bdemand;
					let supply = priceOption.value * Msupply + Bsupply;
					let revenue = consumption * priceOption.value;

					revenueObject[priceOption.value] = {
						"consumption":consumption,
						"supply":supply,
						"revenue":revenue
					}
					//setting up charting data to show the equilibrium price on a chart
					chartData.revenue.push(revenue);
					chartData.supply.push(supply);
					chartData.demand.push(consumption);
					chartData.labels.push("Price per Widget: $"+priceOption.value)

					//check to see if the price and supply calculation is the largest in the set.
					if(maxRevenue <= revenue){
						maxRevenue = revenue;
					}
				})
				return maxRevenue;
			}

			maxRevenue = calculateMaxRevenue(maxRevenue,priceOptions);

			for (var i = 0; i < priceOptions.length; i++) {
				if (priceOptions[i].checked) {
					price = priceOptions[i].value;
					break;
				}
			}

			consumption = revenueObject[price].consumption;
			supply = revenueObject[price].supply;
			revenue = revenueObject[price].revenue;

			if (consumption > supply) {
				consumption = supply;
				message = "ABC Company cannot make enough XYZ Widgets";
			}

			if (consumption <= 0) {
				consumption = 0;
				message = "No one will buy XYZ Widgets at this price";
			}

			
			if (revenue === maxRevenue) {
				message = "This is the equilibrium price"
			}

			document.getElementById("result").innerHTML = "XYZ Supply:"+supply+"/month<br>"+"Price per Widget: $"+price+" per unit<br>"+"XYZ Widgets sold:"+consumption+"/month<br>Revenue:"+revenue+"/month<br><br>"+message;

			const ctx = document.getElementById('myChart');


			new Chart(ctx, {
				data: {
        			datasets: [
						{
							type: 'bar',
							label: 'Total Revenue',
							data: chartData.revenue,
						},
						{
							type: 'line',
							label: 'Total Supply',
							data: chartData.supply,
						},
						{
							type: 'line',
							label: 'Total Demand',
							data: chartData.demand,
						}
				],
					labels:chartData.labels
				}
			});
			}

    </script>
  </body>
</html>